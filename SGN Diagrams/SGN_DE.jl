using Printf
using Statistics
using LinearAlgebra
using Interpolations
using DelimitedFiles
using Plots

#point A dense fix
A_EE_dense_fix=[12.0 12.0 100.0 2.5753173510000003 0.4279984208752129 1200.0; 12.0 12.0 200.0 0.3181374 0.19135609450355037 2400.0; 12.0 12.0 300.0 0.39914639949999997 0.12304148154901774 3600.0; 12.0 12.0 400.0 0.5988283 0.09064790496956796 4812.0; 12.0 12.0 500.0 0.6637088499999999 0.07175056036192545 6000.0; 12.0 12.0 600.0 0.7388382499999999 0.05937111400708659 7212.0; 12.0 12.0 700.0 0.856215199 0.050634047907269185 8412.0; 12.0 12.0 800.0 1.1060182004999999 0.04413822047711906 9612.0; 12.0 12.0 900.0 1.40223035 0.039119381961225566 10800.0; 12.0 12.0 1000.0 1.2303626005 0.03512525861509243 12000.0; 12.0 12.0 1100.0 1.33715615 0.03187111601814841 13200.0; 12.0 12.0 1200.0 1.5117243 0.029168761126338143 14400.0; 12.0 12.0 1300.0 1.6916008505 0.02688882548583993 15600.0; 12.0 12.0 1400.0 1.7315186495 0.02493944832497982 16800.0; 12.0 12.0 1500.0 2.062943901 0.023253602616290035 18000.0]

A_BS3_dense_fix=[12.0 12.0 100.0 3.01200625 0.007838154589096237 3576.0; 12.0 12.0 200.0 0.5282257994999999 0.0038576836085369203 7176.0; 12.0 12.0 300.0 0.7841224 0.0015306022749113394 10776.0; 12.0 12.0 400.0 1.0268569995 0.0011482733151835262 14412.0; 12.0 12.0 500.0 1.2729146505 0.000918698105511009 17976.0; 12.0 12.0 600.0 1.5972053 0.0012782855160120138 21612.0; 12.0 12.0 700.0 2.2222737495000002 0.0010953137739601589 25212.0; 12.0 12.0 800.0 2.03028005 0.0005741936803180841 28812.0; 12.0 12.0 900.0 2.26669565 0.0005103876915409796 32376.0; 12.0 12.0 1000.0 2.5797241499999997 0.0007662867672443549 35976.0; 12.0 12.0 1100.0 2.9212055489999997 0.0006965437558569467 39576.0; 12.0 12.0 1200.0 3.087606149 0.00038277517083725696 43176.0; 12.0 12.0 1300.0 4.0302298500000004 0.00035332663325996774 46776.0; 12.0 12.0 1400.0 4.2439058995 0.0003280853303828989 50376.0; 12.0 12.0 1500.0 4.3626055005 0.0005106446560772351 53976.0]

A_RK4_dense_fix=[12.0 12.0 100.0 2.8110531505 0.004625350704338711 4764.0; 12.0 12.0 200.0 0.6712381995000001 0.0023057045558643988 9564.0; 12.0 12.0 300.0 1.11862895 0.0015351033624671788 14364.0; 12.0 12.0 400.0 1.22627075 0.0011505270777412736 19212.0; 12.0 12.0 500.0 1.7500331994999998 0.0009200307404747165 23964.0; 12.0 12.0 600.0 1.9221203 0.0007664733580294097 28812.0; 12.0 12.0 700.0 2.03279865 0.0006568425509298739 33612.0; 12.0 12.0 800.0 2.3762129 0.0005746486685435496 38412.0; 12.0 12.0 900.0 2.61320615 0.0005107374896987075 43164.0; 12.0 12.0 1000.0 2.83944945 0.00045961953904709703 47964.0; 12.0 12.0 1100.0 3.44974065 0.00041780304368943885 52764.0; 12.0 12.0 1200.0 3.63727985 0.0003829609782344007 57564.0; 12.0 12.0 1300.0 3.6285876994999997 0.0003534827941597835 62364.0; 12.0 12.0 1400.0 4.18834325 0.00032821838134861774 67164.0; 12.0 12.0 1500.0 4.3948877495000005 0.000306324500949871 71964.0]

A_T5_dense_fix=[12.0 12.0 100.0 4.0267184 0.000563139062134344 7140.0; 12.0 12.0 200.0 0.9497682505 0.00027925984995886237 14340.0; 12.0 12.0 300.0 1.3569607000000001 0.00018567574076361047 21540.0; 12.0 12.0 400.0 1.6687561 0.00013907226332661378 28812.0; 12.0 12.0 500.0 2.1890006495 0.0001111697331163177 35940.0; 12.0 12.0 600.0 2.6637352495 9.259268461052667e-5 43212.0; 12.0 12.0 700.0 3.2423751495 7.933537734034317e-5 50412.0; 12.0 12.0 800.0 3.7273143505000004 6.939894565121668e-5 57612.0; 12.0 12.0 900.0 3.8478075005 6.167448182090877e-5 64740.0; 12.0 12.0 1000.0 4.165388699 5.5497345538198166e-5 71940.0; 12.0 12.0 1100.0 4.8047730495 5.044493238447954e-5 79140.0; 12.0 12.0 1200.0 4.9852558995 4.62356917325194e-5 86340.0; 12.0 12.0 1300.0 5.56874115 4.26748097688562e-5 93540.0; 12.0 12.0 1400.0 5.9673145505 3.962319605626567e-5 100740.0; 12.0 12.0 1500.0 6.661558849 3.697889009371161e-5 107940.0]

Plots.plot(A_EE_dense_fix[:,3],hcat(A_EE_dense_fix[:,5],A_BS3_dense_fix[:,5],A_RK4_dense_fix[:,5],A_T5_dense_fix[:,5]),xscale=:log10, yscale=:log10,title="Largest eigenvalue error A",label=["EE DE fix" "BS3 DE fix" "RK4 DE fix" "T5 DE fix"],markershapes= [:circle],xlabel = "number of steps",ylabel = "eigenvalue error",markerstrokewidth = 0,markersize = 5)

Plots.plot(hcat(A_EE_dense_fix[:,6],A_BS3_dense_fix[:,6],A_RK4_dense_fix[:,6],A_T5_dense_fix[:,6]),hcat(A_EE_dense_fix[:,5],A_BS3_dense_fix[:,5],A_RK4_dense_fix[:,5],A_T5_dense_fix[:,5]),xscale=:log10, yscale=:log10,title="Comparaison of methods A",label=["EE DE fix" "BS3 DE fix" "RK4 DE fix" "T5 DE fix"],markershapes= [:circle],xlabel = "function calls",ylabel = "eigenvalue error",markerstrokewidth = 0,markersize = 5)

#point A dense adaptive rtol=const.=1e-8
A_BS3_DE_ad=[1.0e-8 1.0e-5 100.0 2.2175232995000003 0.0005413671141482954 47682.0; 1.0e-8 1.0e-6 100.0 0.6157622505 9.091686003362622e-5 82386.0; 1.0e-8 1.0e-7 100.0 1.044822551 1.5907604737860827e-5 144630.0; 1.0e-8 1.0e-8 100.0 2.3663664005 1.7649790197501212e-6 257472.0; 1.0e-8 1.0e-9 100.0 7.85798745 3.2251613335901635e-7 444366.0; 1.0e-8 1.0e-10 100.0 5.3854691005 7.661533783564655e-8 693738.0]

A_RK4_DE_ad=[1.0e-8 1.0e-5 100.0 0.7543016995 5.000280318664284e-5 117432.0; 1.0e-8 1.0e-6 100.0 0.9336266005 6.48466324616687e-6 159264.0; 1.0e-8 1.0e-7 100.0 11.5714201 7.994508281975614e-7 226512.0; 1.0e-8 1.0e-8 100.0 1.7713100505 1.809801674941142e-7 327240.0; 1.0e-8 1.0e-9 100.0 2.340762 2.5837043959557382e-8 460692.0; 1.0e-8 1.0e-10 100.0 3.17378775 5.599710233985216e-9 620460.0]

A_T5_DE_ad=[1.0e-8 1.0e-5 100.0 3.7356148802 0.0007315709211916383 54936.0; 1.0e-8 1.0e-6 100.0 0.6248184998 0.00017513746422353563 81489.6; 1.0e-8 1.0e-7 100.0 0.6899939998 2.8706326105079996e-6 110260.79999999999; 1.0e-8 1.0e-8 100.0 0.8229416398 2.762082842811965e-6 147340.8; 1.0e-8 1.0e-9 100.0 1.0403097202 4.6014648868881124e-7 183772.8; 1.0e-8 1.0e-10 100.0 1.12638592 1.9863442253759225e-7 209131.19999999998]

Plots.plot(A_BS3_DE_ad[:,2],hcat(A_BS3_DE_ad[:,5],A_RK4_DE_ad[:,5],A_T5_DE_ad[:,5]),xscale=:log10, yscale=:log10,title="Largest eigenvalue error A",label=["BS3 DE ad" "RK4 DE ad" "T5 DE ad"],markershapes= [:circle],xlabel = "absolute tolerance",ylabel = "eigenvalue error")

Plots.plot(hcat(A_BS3_DE_ad[:,6],A_RK4_DE_ad[:,6],A_T5_DE_ad[:,6]),hcat(A_BS3_DE_ad[:,5],A_RK4_DE_ad[:,5],A_T5_DE_ad[:,5]),xscale=:log10, yscale=:log10,title="Largest eigenvalue error A",label=["BS3 DE ad" "RK4 DE ad" "T5 DE ad"],markershapes= [:circle],xlabel = "function calls",ylabel = "eigenvalue error")


#point A dense adaptive rtol=atol
A_BS3_DE_ad_eq=[1.0e-8 1.0e-5 100.0 1.53021264 0.0007133466228818678 46116.0; 1.0e-8 1.0e-6 100.0 0.5162591604 8.929828034302104e-5 79624.79999999999; 1.0e-8 1.0e-7 100.0 0.8300437795999999 1.417570308725764e-5 142200.0; 1.0e-8 1.0e-8 100.0 1.4374282002 1.7843208267296183e-6 257932.80000000002; 1.0e-8 1.0e-9 100.0 2.45912842 2.479995500537527e-7 480628.80000000005; 1.0e-8 1.0e-10 100.0 4.3159260198 3.46079083359077e-8 912808.7999999999]

A_RK4_DE_ad_eq=[1.0e-8 1.0e-5 100.0 2.0083000198 6.522881014415214e-5 113212.79999999999; 1.0e-8 1.0e-6 100.0 0.75615696 6.5574973954661945e-6 159408.0; 1.0e-8 1.0e-7 100.0 1.0957402202 1.1131475294942915e-6 224683.19999999998; 1.0e-8 1.0e-8 100.0 1.6273208801999999 1.6032360824882764e-7 329875.19999999995; 1.0e-8 1.0e-9 100.0 2.3512972004 1.8727909886398927e-8 488880.0; 1.0e-8 1.0e-10 100.0 3.3258900204 2.1944192904391186e-9 746856.0]

A_T5_DE_ad_eq=[1.0e-8 1.0e-5 100.0 0.37379001980000004 0.00041962871775859845 50673.600000000006; 1.0e-8 1.0e-6 100.0 0.5049409697999999 4.842906704588065e-5 77954.4; 1.0e-8 1.0e-7 100.0 0.75140207 3.32043575185777e-6 110743.20000000001; 1.0e-8 1.0e-8 100.0 0.9047940402 1.092498317496969e-6 147679.2; 1.0e-8 1.0e-9 100.0 1.0888710098 8.361965009858674e-8 193428.0; 1.0e-8 1.0e-10 100.0 1.4360181502999998 1.0322903428501342e-8 258105.59999999998]

Plots.plot(A_BS3_DE_ad_eq[:,2],hcat(A_BS3_DE_ad_eq[:,5],A_RK4_DE_ad_eq[:,5],A_T5_DE_ad_eq[:,5]),xscale=:log10, yscale=:log10,title="Largest eigenvalue error A",label=["BS3 DE ad" "RK4 DE ad" "T5 DE ad"],markershapes= [:circle],xlabel = "absolute tolerance=relative tolerance",ylabel = "eigenvalue error")

Plots.plot(hcat(A_BS3_DE_ad_eq[:,6],A_RK4_DE_ad_eq[:,6],A_T5_DE_ad_eq[:,6]),hcat(A_BS3_DE_ad_eq[:,5],A_RK4_DE_ad_eq[:,5],A_T5_DE_ad_eq[:,5]),xscale=:log10, yscale=:log10,title="Largest eigenvalue error A",label=["BS3 DE ad" "RK4 DE ad" "T5 DE ad"],markershapes= [:circle],xlabel = "function calls",ylabel = "eigenvalue error")

#sampling effect
A_RK4_tol6=[1.0e-6 1.0e-6 3.0 0.7095531598000001 1.1113506232178286e-5 153187.2; 1.0e-6 1.0e-6 4.0 0.7076461798 8.786980239911719e-6 155131.2; 1.0e-6 1.0e-6 5.0 0.74315508 8.699111398021149e-6 159048.0; 1.0e-6 1.0e-6 6.0 0.6933009604 7.375927386731787e-6 158342.40000000002; 1.0e-6 1.0e-6 7.0 0.7309939001999999 8.941752734037395e-6 157680.0; 1.0e-6 1.0e-6 8.0 0.7485898395999999 8.270088639221897e-6 159796.8; 1.0e-6 1.0e-6 9.0 0.70909444 9.152268710413925e-6 157464.0; 1.0e-6 1.0e-6 10.0 0.7150345398 8.437110018205877e-6 158515.2; 1.0e-6 1.0e-6 25.0 0.73568752 6.8239207888660146e-6 159033.59999999998; 1.0e-6 1.0e-6 50.0 0.75944386 8.854523326085854e-6 159105.59999999998; 1.0e-6 1.0e-6 100.0 0.8337199402 6.553765731244456e-6 159278.40000000002; 1.0e-6 1.0e-6 200.0 0.9210241198 8.213604305724836e-6 161136.0; 1.0e-6 1.0e-6 300.0 0.91413396 7.648198972227009e-6 161697.59999999998; 1.0e-6 1.0e-6 400.0 0.9159248395999999 7.282030626127322e-6 158414.40000000002; 1.0e-6 1.0e-6 500.0 0.9527453798 8.487239303842216e-6 158356.8; 1.0e-6 1.0e-6 1000.0 1.2340334802000001 7.1575302393228455e-6 160862.40000000002; 1.0e-6 1.0e-6 1500.0 1.7956671598000002 8.054548492859573e-6 159537.59999999998; 1.0e-6 1.0e-6 2000.0 1.6715025602 8.327137370798598e-6 158515.2; 1.0e-6 1.0e-6 2500.0 2.1340804198 6.636923860511163e-6 162129.59999999998; 1.0e-6 1.0e-6 3000.0 2.0300346200000003 7.9634210148669e-6 160401.59999999998]

A_RK4_tol7=[1.0e-7 1.0e-7 3.0 1.0885822495 1.1754638156454983e-6 215496.0; 1.0e-7 1.0e-7 4.0 0.9511898 1.4424798267187943e-6 219672.0; 1.0e-7 1.0e-7 5.0 1.0053120495 1.2853246811244214e-6 220428.0; 1.0e-7 1.0e-7 6.0 1.0280321995 1.2149737426573465e-6 225972.0; 1.0e-7 1.0e-7 7.0 1.0816559005 1.1856623242971104e-6 223488.0; 1.0e-7 1.0e-7 8.0 1.1275740495000002 1.2559052365293633e-6 223344.0; 1.0e-7 1.0e-7 9.0 1.0512440005 1.0107822770158652e-6 222516.0; 1.0e-7 1.0e-7 10.0 0.95644215 1.0297189939085295e-6 223416.0; 1.0e-7 1.0e-7 25.0 1.0819958495000002 1.1284115530316953e-6 224460.0; 1.0e-7 1.0e-7 50.0 1.03842715 1.3037115688971815e-6 222624.0; 1.0e-7 1.0e-7 100.0 1.0689624 1.2627489713850748e-6 224676.0; 1.0e-7 1.0e-7 200.0 1.1906003 1.1455150037361688e-6 222804.0; 1.0e-7 1.0e-7 300.0 1.41088075 1.373253416129405e-6 223560.0; 1.0e-7 1.0e-7 400.0 1.4608301495 1.307728619223837e-6 221796.0; 1.0e-7 1.0e-7 500.0 1.7883348505 1.0455701622613062e-6 223272.0; 1.0e-7 1.0e-7 1000.0 1.6038758 1.0796972406317559e-6 227340.0; 1.0e-7 1.0e-7 1500.0 1.8851300505 1.243471446103125e-6 225036.0; 1.0e-7 1.0e-7 2000.0 2.658092701 1.1520479459604707e-6 221400.0; 1.0e-7 1.0e-7 2500.0 2.1209176999999997 9.864971144548744e-7 226656.0; 1.0e-7 1.0e-7 3000.0 2.61124635 9.93283835903172e-7 222264.0]

A_RK4_tol8=[1.0e-8 1.0e-8 3.0 1.4648563005 2.768835673936849e-7 312336.0; 1.0e-8 1.0e-8 4.0 1.4583332505 1.6346163854400185e-7 315792.0; 1.0e-8 1.0e-8 5.0 1.57130605 1.5387785638244848e-7 325836.0; 1.0e-8 1.0e-8 6.0 1.8015704995 1.695780179902059e-7 325044.0; 1.0e-8 1.0e-8 7.0 1.4880909500000001 1.593017701416456e-7 331920.0; 1.0e-8 1.0e-8 8.0 1.3587224495 1.5283837236797764e-7 327852.0; 1.0e-8 1.0e-8 9.0 1.36540815 1.5720726454336887e-7 327852.0; 1.0e-8 1.0e-8 10.0 1.6064066995 1.440396534199768e-7 326124.0; 1.0e-8 1.0e-8 25.0 1.5498269995 1.6266244822168876e-7 326448.0; 1.0e-8 1.0e-8 50.0 1.60600185 1.5437420584524923e-7 330228.0; 1.0e-8 1.0e-8 100.0 1.4638007499999999 1.4249499699454929e-7 326412.0; 1.0e-8 1.0e-8 200.0 1.5360772 1.6381340117127926e-7 331704.0; 1.0e-8 1.0e-8 300.0 1.5657673504999998 1.771236295721294e-7 328500.0; 1.0e-8 1.0e-8 400.0 1.53969525 1.7771417360289626e-7 328824.0; 1.0e-8 1.0e-8 500.0 1.6906688 1.7218244003212005e-7 332280.0; 1.0e-8 1.0e-8 1000.0 1.8234123004999998 1.6848960378827142e-7 329544.0; 1.0e-8 1.0e-8 1500.0 2.0569176495 1.757712874409752e-7 330660.0; 1.0e-8 1.0e-8 2000.0 2.2517142000000003 1.8504037795167586e-7 330876.0; 1.0e-8 1.0e-8 2500.0 2.38198925 1.3028046443335994e-7 328896.0; 1.0e-8 1.0e-8 3000.0 2.6839911499999998 1.4476377527706383e-7 328716.0]

Plots.plot(A_RK4_tol6[:,3],hcat(A_RK4_tol6[:,5],A_RK4_tol7[:,5],A_RK4_tol8[:,5]),xscale=:log10, yscale=:log10,title="Largest eigenvalue error A",label=["BS3 DE ad" "RK4 DE ad" "T5 DE ad"],markershapes= [:circle],xlabel = "sampling segment number",ylabel = "eigenvalue error")

#Nf compare
A_RK4_DE_ad_long=[1.0e-8 0.01 100.0 0.24297632979999997 0.007529627717404662 35316.0; 1.0e-8 0.001 100.0 0.35437723 0.001712375310968266 56930.399999999994; 1.0e-8 0.0001 100.0 0.43080892989999997 0.00027211376074057117 82022.4; 1.0e-8 1.0e-5 100.0 0.55901645 5.213799910672962e-5 114681.59999999999; 1.0e-8 1.0e-6 100.0 0.7524755101000001 7.58239452691109e-6 158169.59999999998; 1.0e-8 1.0e-7 100.0 1.0459674798 9.699241122347366e-7 225086.40000000002; 1.0e-8 1.0e-8 100.0 1.4771985599999997 1.6044628417032472e-7 328406.4; 1.0e-8 1.0e-9 100.0 2.2843711297 1.9795361099445627e-8 487951.19999999995; 1.0e-8 1.0e-10 100.0 4.579858890100001 2.4687275713561475e-9 746416.8]

Plots.plot(hcat(A_RK4_dense_fix[:,6],A_LM4[:,6]),hcat(A_RK4_dense_fix[:,5],A_LM4[:,5]),xscale=:log10, yscale=:log10,title="Largest eigenvalue error A",label=["RK4 DE fix" "AB4" ],markershapes= [:circle],xlabel = "function calls",ylabel = "eigenvalue error")
Plots.plot!(A_RK4_DE_ad_long[:,6],A_RK4_DE_ad_long[:,5],markershapes= [:circle],label="RK4 ad")

open("temp.txt", "w") do io
           writedlm(io, A_T5_dense_fix)
       end

Plots.savefig("1.pdf")
